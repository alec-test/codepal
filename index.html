<!DOCTYPE html>
<html>
<head>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="https://golden-layout.com/files/latest/js/goldenlayout.min.js"></script>
<link type="text/css" rel="stylesheet" href="https://golden-layout.com/files/latest/css/goldenlayout-base.css" />
<link type="text/css" rel="stylesheet" href="https://golden-layout.com/files/latest/css/goldenlayout-dark-theme.css" />

<title>codePal</title>
</head>
<body>
	


<script>var config = {
    content: [{
        type: 'row',
        content:[{
            type: 'component',
            componentName: 'testComponent',
            componentState: { label: 'A' }
        },{
            type: 'column',
            content:[{
                type: 'component',
                componentName: 'youtube',
                componentState: { label: 'B' }
            },{
                type: 'component',
                componentName: 'testComponent',
                componentState: { label: 'C' }
            }]
        }]
    }]
};

var myLayout = new GoldenLayout( config );

myLayout.registerComponent( 'testComponent', function( container, componentState ){
    container.getElement().html( '<h2>' + componentState.label + '</h2>' );
});

myLayout.registerComponent( 'youtube', function( container, componentState ){
    container.getElement().html( '<form id="search-string">' + '<input placeholder="Search" type="text" id="query">' + '<input type="submit">' + '</form>' + '<div id="search-results"></div>' + '<div id="ytplayer"></div>');
	$(function(){
		
		
		//load youtube API scripts
		loadScripts(); 

		//rest of the work
		rest();
	});

	function loadScripts() {

		
		// Load the IFrame Player API code
		if (typeof(YT) == 'undefined' || typeof(YT.Player) == 'undefined') {
			
			var tag = document.createElement('script');
			tag.src = "https://www.youtube.com/iframe_api";
			var firstScriptTag = document.getElementsByTagName('script')[0];
		
			firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
		}
	}

	function rest() {

		//search button function
		$('#search-string').submit(function(event){
			event.preventDefault();
			var searchTerm = $('#query').val();
			search(searchTerm);
		});
	}

	function search(string){
		//submit button was clicked

		// setUp parameters to be sent to youtube API
		var params = {
					part:'snippet',
					key: "AIzaSyCGO6aUgvp2QoGw5Gw16uItLy1MBnRQF1E",
					q:string
				  };
		url = 'https://www.googleapis.com/youtube/v3/search';

		//send request to youtube API
		$.getJSON(url, params, function(dataJSON){

			//5 videos(on object form) were returned
			var videos = dataJSON.items;

			// loop over the videos returned by API
			for (var i = 0; i < videos.length; i++) {

				var video = videos[i];
				var videoURL = video.snippet.thumbnails.medium.url;
				var videoID = video.id.videoId;

				// We're creating a DOM element for the object
				var img = document.createElement('img');
				img.content = video;
				img.setAttribute("id", videoID);
				img.setAttribute("src", videoURL);
				
				//TODO:reaches here
				console.log(img); 
				
				// ... and when we click, load the respective video
				img.addEventListener('click', (function(clickEvent) {
					return function() {
						
						//TODO: does not reach here
						console.log(img);					
						
						var YoutubeVideoID = $(this).attr('id');

						// Replace the 'ytplayer' imgent with an <iframe> and
						// YouTube player after the API code downloads.
						var player = new YT.Player('ytplayer', {
							height : '360',
							width : '640',
							videoId : YoutubeVideoID
						});
					};
				})(video));
				
				$(img).appendTo("#search-results");

			}

		});
		
		
	}

});

myLayout.init();

</script>
</body>
</html>